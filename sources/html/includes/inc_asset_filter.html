<!-- filter -->
<fieldset class="filter-container">
	<legend>Asset filter</legend>

	<button type="button" class="btn-status">Open Filters</button>

	<div class="results">
		<span class="category">
			<select name="" id="" class="selectric">
				<option value="0" selected>AWS</option>
				<option value="1">AZURE</option>
			</select>
		</span>
		<span class="selected"></span>
	</div>


	<div class="items">
		<fieldset class="filter-item">
			<legend class="title"><span>CLOUD ACCOUNTS</span></legend>

			<ul class="list-filter-items">
				<li>
					<label for="all-accounts" class="icheck">
						<input type="checkbox" id="all-accounts" name="all-accounts" data-all="account" data-title="CLOUD ACCOUNTS" class="icheckbox">
						All Accounts
					</label>
				</li>
				<li>
					<button type="button" class="btn-folding is-opened">open/close</button>
					<label for="all-aws" class="icheck">
						<input type="checkbox" id="all-aws" name="all-aws" data-ref="account" data-all="aws" class="icheckbox">
						AWSasdfjiaweofjiaowejfiaoejfiowaefasdfasdfawef
					</label>
					
					<ul class="list-filter-items">
						<li>
							<label for="aws01" class="icheck">
								<input type="checkbox" id="aws01" name="aws" data-ref="aws" class="icheckbox">
								129438483
							</label>
						</li>
						<li>
							<button type="button" class="btn-folding is-opened">open/close</button>
							<label for="aws02" class="icheck">
								<input type="checkbox" id="aws02" name="aws" data-ref="aws" data-all="test" class="icheckbox">
								494737173
							</label>

							<ul class="list-filter-items">
								<li>
									<label for="test01" class="icheck">
										<input type="checkbox" id="test01" name="test" data-ref="test" class="icheckbox">
										129438483
									</label>
								</li>
								<li>
									<label for="test02" class="icheck">
										<input type="checkbox" id="test02" name="test" data-ref="test" class="icheckbox">
										494737173
									</label>
								</li>
								<li>
									<label for="test03" class="icheck">
										<input type="checkbox" id="test03" name="test" data-ref="test" class="icheckbox">
										129438483
									</label>
								</li>
							</ul>

						</li>
						<li>
							
							<label for="aws03" class="icheck">
								<input type="checkbox" id="aws03" name="aws" data-ref="aws" class="icheckbox">
								129438483
							</label>
						</li>
						<li>
							
							<label for="aws04" class="icheck">
								<input type="checkbox" id="aws04" name="aws" data-ref="aws" class="icheckbox">
								494737173
							</label>
						</li>
					</ul>
				</li>
				<li>
					<label for="aws05" class="icheck">
						<input type="checkbox" id="aws05" name="aws" data-ref="account" class="icheckbox">
						129438483
					</label>
				</li>
				<li>
					<label for="aws06" class="icheck">
						<input type="checkbox" id="aws06" name="aws" data-ref="account" class="icheckbox">
						494737173
					</label>
				</li>
				<li>
					<label for="aws07" class="icheck">
						<input type="checkbox" id="aws07" name="aws" data-ref="account" class="icheckbox">
						129438483
					</label>
				</li>
				<li>
					<label for="aws08" class="icheck">
						<input type="checkbox" id="aws08" name="aws" data-ref="account" class="icheckbox">
						494737173
					</label>
				</li>
				<li>
					<button type="button" class="btn-folding is-opened">open/close</button>
					<label for="all-azure" class="icheck">
						<input type="checkbox" id="all-azure" name="all-azure" data-ref="account" data-all="azure" class="icheckbox">
						azure
					</label>
					
					<ul class="list-filter-items">
						<li>
							<label for="azure01" class="icheck">
								<input type="checkbox" id="azure05" name="azure" data-ref="azure" class="icheckbox">
								129438483
							</label>
						</li>
						<li>
							<label for="azure02" class="icheck">
								<input type="checkbox" id="azure06" name="azure" data-ref="azure" class="icheckbox">
								494737173
							</label>
						</li>
						<li>
							<label for="azure03" class="icheck">
								<input type="checkbox" id="azure07" name="azure" data-ref="azure" class="icheckbox">
								129438483
							</label>
						</li>
					</ul>
				</li>
			</ul>
		</fieldset>



		<fieldset class="filter-item">
			<legend class="title"><span>SERVICE GROUPS</span></legend>

			<ul class="list-filter-items">
				<li>
					<label for="all-service-group" class="icheck">
						<input type="checkbox" id="all-service-group" name="all-service-group" data-all="service" data-title="SERVICE GROUPS" class="icheckbox">
						All Service Group
					</label>
				</li>
				<li>
					<label for="service01" class="icheck">
						<input type="checkbox" id="service01" name="service" data-ref="service" class="icheckbox">
						Maple Story2
					</label>
				</li>
<!--
				<li>
					<label for="service02" class="icheck">
						<input type="checkbox" id="service02" name="service" data-ref="service" class="icheckbox">
						Line Talk
					</label>
				</li>
				<li>
					<label for="service03" class="icheck">
						<input type="checkbox" id="service03" name="service" data-ref="service" class="icheckbox">
						Line Pay
					</label>
				</li>
				<li>
					<label for="service04" class="icheck">
						<input type="checkbox" id="service04" name="service" data-ref="service" class="icheckbox">
						Line Rangers
					</label>
				</li>
				<li>
					<label for="service05" class="icheck">
						<input type="checkbox" id="service05" name="service" data-ref="service" class="icheckbox">
						Line XYZ
					</label>
				</li>
				<li>
					<label for="service06" class="icheck">
						<input type="checkbox" id="service06" name="service" data-ref="service" class="icheckbox">
						Kakao Talk
					</label>
				</li>
				<li>
					<label for="service07" class="icheck">
						<input type="checkbox" id="service07" name="service" data-ref="service" class="icheckbox">
						Kakao Taxi
					</label>
				</li>
				<li>
					<label for="service08" class="icheck">
						<input type="checkbox" id="service08" name="service" data-ref="service" class="icheckbox">
						Kakao Driver
					</label>
				</li>
-->
			</ul>
		</fieldset>


		<fieldset class="filter-item">
			<legend class="title"><span>REGION</span></legend>

			<ul class="list-filter-items">
				<li>
					<label for="all-regions" class="icheck">
						<input type="checkbox" id="all-regions" name="all-regions" data-all="region" data-title="REGION" class="icheckbox">
						All Regions
					</label>
				</li>
				<li>
					<label for="regions01" class="icheck">
						<input type="checkbox" id="regions01" name="regions" data-ref="region" class="icheckbox">
						South Korea
					</label>
				</li>
				<li>
					<label for="regions02" class="icheck">
						<input type="checkbox" id="regions02" name="regions" data-ref="region" class="icheckbox">
						US-East
					</label>
				</li>
				<li>
					<label for="regions03" class="icheck">
						<input type="checkbox" id="regions03" name="regions" data-ref="region" class="icheckbox">
						China
					</label>
				</li>
				<li>
					<label for="regions04" class="icheck">
						<input type="checkbox" id="regions04" name="regions" data-ref="region" class="icheckbox">
						Japan
					</label>
				</li>
				<li>
					<label for="regions05" class="icheck">
						<input type="checkbox" id="regions05" name="regions" data-ref="region" class="icheckbox">
						US-West
					</label>
				</li>
			</ul>
		</fieldset>


		<fieldset class="filter-item">
			<legend class="title"><span>INFRASTRUCTURE</span></legend>

			<ul class="list-filter-items">
				<li>
					<label for="infrastructure01" class="icheck">
						<input type="radio" id="infrastructure01" name="infrastructure" class="iradio" checked>
						EC2
					</label>
				</li>
				<li>
					<label for="infrastructure02" class="icheck">
						<input type="radio" id="infrastructure02" name="infrastructure" class="iradio">
						EBS
					</label>
				</li>
				<li>
					<label for="infrastructure03" class="icheck">
						<input type="radio" id="infrastructure03" name="infrastructure" class="iradio">
						RDS
					</label>
				</li>
				<li>
					<label for="infrastructure04" class="icheck">
						<input type="radio" id="infrastructure04" name="infrastructure" class="iradio">
						S3
					</label>
				</li>
				<li>
					<label for="infrastructure05" class="icheck">
						<input type="radio" id="infrastructure05" name="infrastructure" class="iradio">
						VRD
					</label>
				</li>
				<li>
					<label for="infrastructure06" class="icheck">
						<input type="radio" id="infrastructure06" name="infrastructure" class="iradio">
						AXC
					</label>
				</li>
			</ul>
		</fieldset>


		<p class="done">
			<input type="submit" class="btn-normal" value="DONE">
			<button type="button" class="btn-text reset">Reset Filters</button>
<!--
			<button type="button" class="btn-text reset">Save as Defaults</button>
-->
		</p>
	</div>
</fieldset>
<script>
$(document).ready(function(e) {	
	/* Filter */
	var Filter = (function ($) {
		var scope,
			$container,
			$btnToggleContainer,
			$btnToggleItems,
			$btnReset,
			$selectedLabels,
			$allItem,
			$checkItems,
			$btnDone,
			init = function() {
				$container = $('.filter-container');
				$btnToggleContainer = $container.find('.btn-status');
				$btnToggleItems = $container.find('.btn-folding');
				$btnReset = $container.find('.btn-text.reset');
				$selectedLabels = $container.find('.results > .selected');

				$allItem = $container.find('input[data-all]');
				$checkItems = $container.find('input[data-ref]');

				$btnDone = $container.find('.done > .btn-normal');

				initLayout();
				initEvent();
			};

		function initLayout() {
			_initCount();
			_updateSelectedLabels();
		}

		function initEvent() {
			// open / close
			$btnToggleContainer.on('click', function(e) {
				if( $container.hasClass('is-opened') ) {
					$container.removeClass('is-opened');
					$btnToggleContainer.text('Open Filters');
				} else {
					$container.addClass('is-opened');
					$btnToggleContainer.text('Close');
				}
			});

			// item open / close
			$btnToggleItems.on('click', function(e) {
				var $this = $(e.target);
				$this.toggleClass('is-opened');
			});

			// reset
			$btnReset.on('click', function(e) {
				e.preventDefault();

				$('input.icheckbox').iCheck('uncheck');
				$('input.iradio').iCheck('uncheck');
			});

			// all checked / all unchecked
			$allItem.on('ifToggled', function(e) {
				var target = $(this).data('all');
				var $items = $('input[data-ref=' + target + ']');

				if( $(this).prop("checked") ) {
					$items.iCheck("check");
				} else {
					$items.iCheck("uncheck");
				}
			});

			$checkItems.on('ifChanged', function(e) {
				var target = $(this).data('ref');
				var $all = $('input[data-all=' + target + ']');
				var $items = $('input[data-ref=' + target + ']');
				var $checked = $('input[data-ref=' + target + ']:checked');

				if( $checked.length > 0 ) {
					if( $items.length !== $checked.length ) {
						$all.iCheck('indeterminate');
					} else {
						$all.iCheck('check');
					}
				} else {
					$all.iCheck('uncheck');
					$all.iCheck('determinate');
				}
				
			});

			$checkItems.on('ifIndeterminate', function(e) {
				var target = $(this).data('ref');
				var $all = $('input[data-all=' + target + ']');
				$all.iCheck('indeterminate');
			});

			// done
			$btnDone.on('click', function(e) {
				_updateSelectedLabels();
			});
		}

		function _initCount() {
			// init count
			$($allItem.get().reverse()).each(function() {
				var target = $(this).data('all');
				var $refLabel = $(this).closest("label");
				var $items = $('input[data-ref=' + target + ']');
				var $subs = $items.filter('[data-count]');
				var total = 0;
				$subs.each(function() {
					total = total + $(this).data('count') - 1;
				});

				var cnt = $items.length + total;
				$(this).attr("data-count", cnt);
				$refLabel.append('<em class="count">(' + cnt + ')</em>');
			});

			_allChecked();
		}


		function _allChecked() {
			$allItem.each(function(e) {
				var target = $(this).data('all');
				var $items = $('input[data-ref=' + target + ']');

				$(this).iCheck("check");
				$items.iCheck("check");
			});
		}


		function _updateSelectedLabels() {
			var checkedLabels = [];

			var $filterItems = $('.filter-item');
			$filterItems.each(function() {
				var $checed = $(this).find('input[data-ref]:checked');
				var $except = $(this).find('input[data-all]:checked');

				var cnt = $checed.length - $except.length;
				if( cnt > 0 ) {
					var result = $(this).find('input[data-title]').data('title') + '(' + cnt + ')';
					checkedLabels.push(result);
				}
			}).promise().done(function () { 
				var infrastructure = $container.find('input[type=radio]:checked').closest('label').text().trim();
				if( infrastructure.length > 0 ) {
					checkedLabels.push(infrastructure);
				}
    			$selectedLabels.html(checkedLabels.join(", "));
			});
		}

		return {
			init: function() {
				init();
			},
			updateSelectedLabels: function() {
				_updateSelectedLabels();
			},
			allChecked: function() {
				_allChecked();
			}
		};
	}(jQuery));

	
	Filter.init();
});
</script>
<!--// filter -->
